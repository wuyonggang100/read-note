组合模式

组合模式就是用小的子对象来构建更大的对象，而这些小的子对象本身也许是由更
小的“孙对象”构成的。

宏命令组成了一个树形结构，其中有组合对象，叶对象；组合对象表现得像一个命令，但实际上只是一组真正命令的代理，并非真正的代理，它值负责将请求传递给叶对象，它的目的不在于控制叶对象的访问。

组合模式用途

组合模式将对象组合成树形结构，以表示“部分整体”的层次结构。 除了用来表示树形结
构之外，组合模式的另一个好处是通过对象的多态性表现，使得用户对单个对象和组合对象的使
用具有一致性。

- 表示树形结构：组合模式可以非常方便地描述对象部分整体层次结构。提供了一种遍历树形结构的方案，通过调用组合对象的某个方法，程序会递归调用组合对象下面的叶对象的指定方法。
- 利用对象多态性统一对待组合对象和单个对象。利用对象的多态性表现，可以使客户端忽略组合对象和单个对象的不同。在组合模式中，客户将统一地使用组合结构中的所有对象，而不需要关心它究竟是组合对象还是单个对象。在实际开发中可以带来便利性，不需要关心某个命令是宏命令还是普通命令，当接收到执行方法时，他们都会做自己认为正确的事。



请求传递过程

以宏命令为例，请求从树最顶端的对象往下传递，如果当前处理请求的对象是叶对象（普通子命令），叶对象自身会对请求作出相应的处理；如果当前处理请求的对象是组合对象（宏命令），组合对象则会遍历它属下的子节点，将请求继续传递给这些子节点。总而言之，如果子节点是叶对象，叶对象自身会处理这个请求，而如果子节点还是组合对象，请求会继续往下传递。叶对象下面不会再有其他子节点，一个叶对象就是树的这条枝叶的尽头。使用者只需要关心最顶层的组合对象。

抽象类在组合模式中的作用

组合模式最大的优点在于可以一致地对待组合对象和基本对象。客户不需要知道当前处理的是宏命令还是普通命令，只要它是一个命令，并且有execute 方法，这个命令就可以被添加到树中。

在Java 中，实现组合模式的关键是Composite 组合 类和Leaf叶子 类都必须继承自一个Compenent 抽象类。这个Compenent 抽象类既代表组合对象，又代表叶对象，它也能够保证组合对象和叶对象拥有同样名字的方法，从而可以对同一消息都做出反馈。组合对象和叶对象的具体类型被隐藏在Compenent 抽象类身后。

组合对象可以拥有子节点，叶对象下面就没有子节点， 所以我们也许会发生一些误操作，比如试图往叶对象中添加子节点。解决方案通常是给叶对象也增加add 方法，并且在调用这个方法时，抛出一个异常来及时提醒客户，

```java
public abstract class Component{
    //add 方法，参数为Component 类型
    public void add( Component child ){}
    //remove 方法，参数为Component 类型
    public void remove( Component child ){}
}
// 组合类继承自 Component 类
public class Composite extends Component{
    //add 方法，参数为Component 类型
    public void add( Component child ){}
    //remove 方法，参数为Component 类型
    public void remove( Component child ){}
}
// 叶子类
public class Leaf extends Component{
    //add 方法，参数为Component 类型
    public void add( Component child ){
        throw new UnsupportedOperationException() // 叶对象不能再添加子节点
    }
    //remove 方法，参数为Component 类型
    public void remove( Component child ){
    }
}
public class client(){
    public static void main( String args[] ){
        Component root = new Composite();
        Component c1 = new Composite();
        Component c2 = new Composite();

        Component leaf1 = new Leaf();
        Component leaf2 = new Leaf();
        root.add(c1);
        root.add(c2);
        c1.add(leaf1);
        c1.add(leaf2);
        root.remove();
    }
}
```

组合模式使用场景：

- 表示对象的部分整体层次结构。组合模式可以方便地构造一棵树来表示对象的部分整体结构。特别是我们在开发期间不确定这棵树到底存在多少层次的时候。在树的构造最终完成之后，只需要通过请求树的最顶层对象，便能对整棵树做统一的操作。在组合模式中增加和删除树的节点非常方便，并且符合开放封闭原则。
- 客户希望统一对待树中的所有对象。组合模式使客户可以忽略组合对象和叶对象的区别，客户在面对这棵树的时候，不用关心当前正在处理的对象是组合对象还是叶对象，也就不用写一堆if、else 语句来分别处理它们。组合对象和叶对象会各自做自己正确的事情，这是组合模式最重要的能力。

组合模式的优缺点

优点：组合模式可以让我们使用树形方式创建对象的结构。我们可以把相同的操作应用在组合对象和单个对象上。在大多数情况下，我们都可以忽略掉组合对象和单个对象之间的差别，从而用一致的方式来处理它们。

缺点：组合模式并不是完美的，它可能会产生一个这样的系统：系统中的每个对象看起来都与其他对象差不多。它们的区别只有在运行的时候会才会显现出来，这会使代码难以理解。此外，如果通过组合模式创建了太多的对象，那么这些对象可能会让系统负担不起。